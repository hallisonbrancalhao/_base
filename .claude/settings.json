{
  "plansDirectory": ".agent/Plans",
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "hooks": {
    "SessionStart": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "echo '<system-reminder>'; echo 'SESSION CONTEXT:'; echo ''; echo 'Recent commits:'; git log --oneline -5 2>/dev/null || echo 'No git history'; echo ''; echo 'Changed files (last commit):'; git diff --stat HEAD~1 2>/dev/null | tail -5 || echo 'No changes'; echo '</system-reminder>'; exit 0",
            "timeout": 10
          }
        ]
      }
    ],
    "UserPromptSubmit": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "PROMPT=\"$CLAUDE_USER_CONTENT\"; if echo \"$PROMPT\" | grep -qiE 'implement|criar|adicionar|refactor|nx g|gerar|build|develop'; then echo '<system-reminder>IMPLEMENTATION DETECTED: Read .agent/System/libs_architecture_pattern.md and .agent/System/base_rules.md before implementing. Use Facade Pattern, standalone components, direct imports.</system-reminder>'; fi; exit 0",
            "timeout": 3
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "echo \"$CLAUDE_TOOL_INPUT\" | jq -r '.command' | grep -qE '^git commit' && { echo 'ðŸ” Pre-commit: Running Nx affected validations...'; pnpm nx affected:lint --base=HEAD~1 2>/dev/null && pnpm nx affected:test --base=HEAD~1 2>/dev/null && pnpm nx affected:build --base=HEAD~1 2>/dev/null || { echo 'âŒ Validation failed! Fix issues before committing.'; exit 2; }; }; exit 0",
            "timeout": 600
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "FILE=\"$(echo \"$CLAUDE_TOOL_INPUT\" | jq -r '.file_path // .filePath // empty')\"; if [ -n \"$FILE\" ] && { [[ \"$FILE\" == *.ts ]] || [[ \"$FILE\" == *.html ]] || [[ \"$FILE\" == *.json ]]; }; then pnpm prettier --write \"$FILE\" 2>/dev/null || true; fi; exit 0",
            "timeout": 30
          }
        ]
      },
      {
        "matcher": "ExitPlanMode",
        "hooks": [
          {
            "type": "command",
            "command": "PLANS_DIR=\"${CLAUDE_WORKING_DIRECTORY}/.agent/Plans\"; TASKS_DIR=\"${CLAUDE_WORKING_DIRECTORY}/.agent/Tasks\"; mkdir -p \"$TASKS_DIR\"; PLAN=$(find \"$PLANS_DIR\" -maxdepth 1 -name '*.md' -type f ! -name 'README*' -mmin -5 2>/dev/null | head -1); if [ -n \"$PLAN\" ]; then NAME=$(basename \"$PLAN\" .md | tr '[:upper:]' '[:lower:]' | tr ' ' '_' | tr -cd '[:alnum:]_-'); PRD_ID=\"PRD-$(date +%Y-%m)-001\"; PRD_FILE=\"$TASKS_DIR/${PRD_ID}_${NAME}.md\"; echo \"<system-reminder>\"; echo \"PLAN APPROVED - PRD Creation\"; echo \"\"; echo \"Plan file: $PLAN\"; echo \"Create PRD at: $PRD_FILE\"; echo \"\"; echo \"Next steps:\"; echo \"1. Use Task tool with sub-agents to investigate context\"; echo \"2. Create structured PRD following .agent/Tasks/README.md template\"; echo \"3. Archive plan to .agent/Plans/archive/\"; echo \"\"; echo \"Recommended agents:\"; echo \"- Explore: Codebase patterns\"; echo \"- Plan: Architecture validation\"; echo \"- general-purpose with @ux-researcher: User needs (if UI)\"; echo \"</system-reminder>\"; fi; exit 0",
            "timeout": 10
          }
        ]
      }
    ],
    "Setup": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "echo 'ðŸ“¦ Installing dependencies...'; pnpm install && echo '<system-reminder>Dependencies installed successfully with pnpm.</system-reminder>'; exit 0",
            "timeout": 120
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "echo '<system-reminder>'; echo 'CONTEXT COMPACTING - Key info preserved:'; echo ''; echo 'Current branch:'; git branch --show-current 2>/dev/null || echo 'unknown'; echo ''; echo 'Uncommitted changes:'; git status --short 2>/dev/null | head -10 || echo 'none'; echo '</system-reminder>'; exit 0",
            "timeout": 5
          }
        ]
      }
    ]
  },
  "permissions": {
    "allow": [
      "Read",
      "Edit",
      "Write",
      "Bash(pnpm *)",
      "Bash(npm *)",
      "Bash(npx nx *)",
      "Bash(nx *)",
      "Bash(ng *)",
      "Bash(git *)",
      "Bash(cat *)",
      "Bash(ls *)",
      "Bash(grep *)",
      "Bash(find *)",
      "Bash(tree *)",
      "Bash(gh *)"
    ],
    "deny": [
      "Read(.env*)",
      "Write(.env*)",
      "Bash(rm -rf /)",
      "Bash(sudo *)"
    ]
  }
}
